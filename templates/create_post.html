{% extends 'base.html' %} {% block title %}Create Post - HiveBuzz{% endblock %}
{% block content %}
<div class="create-post-container">
	<h2>Create New Post</h2>

	<form
		action="{{ url_for('create_post') }}"
		method="post"
		class="post-form"
		id="post-form"
	>
		<div class="form-group">
			<label for="title">Title</label>
			<input
				type="text"
				id="title"
				name="title"
				placeholder="Enter post title"
				required
			/>
		</div>

		<div class="form-group">
			<label for="body">Content</label>
			<textarea
				id="body"
				name="body"
				rows="10"
				placeholder="Write your post content here..."
				required
			></textarea>
		</div>

		<div class="form-group">
			<label for="tags">Tags (comma separated)</label>
			<input
				type="text"
				id="tags"
				name="tags"
				placeholder="hive,dbuzz,crypto,blog"
			/>
		</div>

		<input
			type="hidden"
			name="author-username"
			id="author-username"
			value="{{ session.username }}"
		/>

		<div class="form-actions">
			<button type="button" id="preview-btn" class="btn btn-secondary">
				Preview
			</button>
			<button type="submit" id="publish-btn" class="btn">
				Publish Post
			</button>
		</div>
	</form>

	<div id="post-preview" style="display: none">
		<h3>Post Preview</h3>
		<div class="post-preview">
			<h1 id="preview-title"></h1>
			<div class="post-meta">
				<span class="post-author">@{{ session.username }}</span>
				<span class="post-date">Just now</span>
			</div>
			<div class="post-content" id="preview-content"></div>
			<div class="post-tags" id="preview-tags"></div>
		</div>
		<button type="button" id="edit-btn" class="btn btn-secondary">
			Edit
		</button>
	</div>
</div>
{% endblock %} {% block scripts %}
<script>
	document.addEventListener("DOMContentLoaded", function () {
		const postForm = document.getElementById("post-form");
		const previewBtn = document.getElementById("preview-btn");
		const editBtn = document.getElementById("edit-btn");
		const previewSection = document.getElementById("post-preview");

		// Preview functionality
		if (previewBtn) {
			previewBtn.addEventListener("click", function () {
				const title = document.getElementById("title").value;
				const body = document.getElementById("body").value;
				const tags = document.getElementById("tags").value;

				if (!title || !body) {
					alert("Title and content are required for preview.");
					return;
				}

				// Display the preview
				document.getElementById("preview-title").textContent = title;
				document.getElementById("preview-content").innerHTML =
					body.replace(/\n/g, "<br>");

				// Process tags
				const tagElements = tags
					.split(",")
					.map((tag) => tag.trim())
					.filter((tag) => tag)
					.map((tag) => `<span class="tag">${tag}</span>`)
					.join("");
				document.getElementById("preview-tags").innerHTML = tagElements;

				// Show preview, hide form
				previewSection.style.display = "block";
				postForm.style.display = "none";
			});
		}

		// Return to editing
		if (editBtn) {
			editBtn.addEventListener("click", function () {
				previewSection.style.display = "none";
				postForm.style.display = "block";
			});
		}
	});
</script>
{% endblock %}
